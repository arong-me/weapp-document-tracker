<div class="book with-summary">

<div class="head">

<div class="head_box">

# [](javascript:; "_('微信公众平台 小程序')")

<div class="header_ctrls">

*   [介绍](javascript:;)
    *   [小程序介绍](https://developers.weixin.qq.com/miniprogram/introduction/index.html?t=18110517)
    *   [小游戏介绍](https://developers.weixin.qq.com/minigame/introduction/index.html?t=18110517)
*   [设计](https://developers.weixin.qq.com/miniprogram/design/index.html?t=18110517)
*   [小程序开发](javascript:;)
    *   [小程序开发](https://developers.weixin.qq.com/miniprogram/dev/index.html?t=18110517)
    *   [小游戏开发](https://developers.weixin.qq.com/minigame/dev/index.html?t=18110517)
*   [运营](https://developers.weixin.qq.com/miniprogram/product/index.html?t=18110517)
*   [数据](javascript:;)
    *   [小程序数据](https://developers.weixin.qq.com/miniprogram/analysis/index.html?t=18110517)
    *   [小游戏数据](https://developers.weixin.qq.com/minigame/analysis/index.html?t=18110517)
*   [社区](https://developers.weixin.qq.com/)

*   [中文](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages/request-payment.html?t=18110517)<span class="split-line">/</span>
*   [EN](https://developers.weixin.qq.com/miniprogram/en/dev/framework/plugin/functional-pages/request-payment.html?t=18110517)

</div>

</div>

</div>

<div class="sub_nav_box">

<div class="sub_nav_inner">

<div class="book-summary-opr" id="js-book-summary-opr"><a class="book-summary-btn"></a></div>

<div class="top_sub_nav">

<div class="top_title_wap"><span class="icon_title icon_dev"></span>

微信小程序开发文档

</div>

*   [简易教程](../../../)
*   [框架](../../MINA.html)
*   [组件](../../../component/)
*   [API](../../../api/)
*   [工具](../../../devtools/devtools.html)
*   [小程序·云开发](../../../wxcloud/basis/getting-started.html)

</div>

<div id="book-search-input" role="search">

<form><label for="search-input" class="search-icon" id="js-search-icon"></label><input type="text" id="search-input" name="search-input" placeholder="搜索"> </form>

</div>

*   [中文](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages/request-payment.html?t=18110517)<span class="split-line">/</span>
*   [EN](https://developers.weixin.qq.com/miniprogram/en/dev/framework/plugin/functional-pages/request-payment.html?t=18110517)

</div>

</div>

<div class="book-summary">

<div class="book-summary-home" id="js-summary-home"><a><span class="icon_home_s icon_dev"></span><span class="s_title_2">开发文档首页</span></a></div>

<nav role="navigation">

*   [目录结构](../../structure.html)
*   [配置](../../config.html)
    *   [全局配置](../../config.html#全局配置)
    *   [页面配置](../../config.html#页面配置)
*   [逻辑层](../../app-service/)
    *   [注册程序](../../app-service/app.html)
    *   [场景值](../../app-service/scene.html)
    *   [注册页面](../../app-service/page.html)
        *   [初始数据](../../app-service/page.html#data)
        *   [生命周期回调函数](../../app-service/page.html#生命周期回调函数)
        *   [页面事件处理函数](../../app-service/page.html#页面事件处理函数)
        *   [组件事件处理函数](../../app-service/page.html#组件事件处理函数)
        *   [route](../../app-service/page.html#pageroute)
        *   [setData](../../app-service/page.html#pageprototypesetdataobject-data-function-callback)
        *   [页面生命周期](../../app-service/page.html#生命周期)
    *   [路由](../../app-service/route.html)
    *   [模块化](../../app-service/module.html)
    *   [API](../../app-service/api.html)
*   [视图层](../../view/)
    *   [WXML](../../view/wxml/)
        *   [数据绑定](../../view/wxml/data.html)
        *   [列表渲染](../../view/wxml/list.html)
        *   [条件渲染](../../view/wxml/conditional.html)
        *   [模板](../../view/wxml/template.html)
        *   [事件](../../view/wxml/event.html)
        *   [引用](../../view/wxml/import.html)
    *   [WXSS](../../view/wxss.html)
    *   [基础组件](../../view/component.html)
    *   [WXS](../../view/wxs/)
        *   [模块](../../view/wxs/01wxs-module.html)
        *   [变量](../../view/wxs/02variate.html)
        *   [注释](../../view/wxs/03annotation.html)
        *   [运算符](../../view/wxs/04operator.html)
        *   [语句](../../view/wxs/05statement.html)
        *   [数据类型](../../view/wxs/06datatype.html)
        *   [基础类库](../../view/wxs/07basiclibrary.html)
    *   [获取界面上的节点信息](../../view/selector.html)
    *   [响应显示区域变化](../../view/resizable.html)
*   [自定义组件](../../custom-component/)
    *   [组件模板和样式](../../custom-component/wxml-wxss.html)
    *   [Component构造器](../../custom-component/component.html)
    *   [组件事件](../../custom-component/events.html)
    *   [behaviors](../../custom-component/behaviors.html)
    *   [组件间关系](../../custom-component/relations.html)
    *   [抽象节点](../../custom-component/generics.html)
    *   [自定义组件扩展](../../custom-component/extend.html)
    *   [开发第三方自定义组件](../../custom-component/trdparty.html)
*   [插件](../)
    *   [开发插件](../development.html)
    *   [使用插件](../using.html)
    *   [插件调用 API 的限制](../api-limit.html)
    *   [插件使用组件的限制](../component-limit.html)
    *   [插件功能页](../functional-pages.html)
        *   [用户信息功能页](./user-info.html)
        *   [支付功能页](./request-payment.html)
        *   [收货地址功能页](./choose-address.html)
*   [基础能力](../../ability/network.html)
    *   [网络](../../ability/network.html)
        *   [使用说明](../../ability/network.html)
        *   [局域网通信](../../ability/mDNS.html)
    *   [存储](../../ability/storage.html)
    *   [文件系统](../../ability/file-system.html)
    *   [画布](../../ability/canvas.html)
    *   [分包加载](../../subpackages.html)
        *   [使用分包](../../subpackages/basic.html)
        *   [独立分包](../../subpackages/independent.html)
        *   [分包预下载](../../subpackages/preload.html)
    *   [多线程 Worker](../../workers.html)
*   [硬件能力](../../device/bluetooth.html)
    *   [蓝牙](../../device/bluetooth.html)
    *   [NFC](../../device/nfc.html)
    *   [Wi-Fi](../../device/wifi.html)
*   [开放能力](../../open-ability/login.html)
    *   [用户信息](../../open-ability/login.html)
        *   [小程序登录](../../open-ability/login.html)
        *   [UnionID 机制说明](../../open-ability/union-id.html)
        *   [授权](../../open-ability/authorize.html)
        *   [开放数据校验与解密](../../open-ability/signature.html)
        *   [获取手机号](../../open-ability/getPhoneNumber.html)
        *   [生物认证](../../open-ability/bio-auth.html)
    *   [转发](../../open-ability/share.html)
        *   [转发](../../open-ability/share.html)
        *   [动态消息](../../open-ability/share/updatable-message.html)
    *   [打开App](../../open-ability/launchApp.html)
    *   [消息](../../open-ability/template-message.html)
        *   [模板消息](../../open-ability/template-message.html)
        *   [统一服务消息](../../open-ability/uniform-message.html)
        *   [客服消息](../../open-ability/customer-message/customer-message.html)
            *   [概述](../../open-ability/customer-message/customer-message.html)
            *   [接收消息和事件](../../open-ability/customer-message/receive.html)
            *   [发送消息](../../open-ability/customer-message/send.html)
            *   [转发消息](../../open-ability/customer-message/trans.html)
            *   [下发客服输入状态](../../open-ability/customer-message/typing.html)
            *   [临时素材](../../open-ability/customer-message/temp-media.html)
    *   [卡券](../../open-ability/card/card.html)
        *   [概述](../../open-ability/card/card.html)
        *   [会员卡组件](../../open-ability/card/membership-card.html)
    *   [获取二维码](../../open-ability/qr-code.html)
    *   [数据分析](../../open-ability/data-analysis.html)
    *   [附近的小程序](../../open-ability/nearby.html)
*   [可用性](../../usability/debug.html)
    *   [调试](../../usability/debug.html)
    *   [运行环境](../../details.html)
        *   [平台差异](../../details.html#平台差异)
        *   [ES6 支持情况](../../details.html#客户端-es6-api-支持情况)
    *   [运行机制](../../operating-mechanism.html)
    *   [性能](../../performance/)
        *   [优化建议](../../performance/tips.html)
        *   [分析工具](../../performance/tools.html)
*   [基础库](../../client-lib/)
    *   [版本分布](../../client-lib/version.html)
    *   [与客户端版本对应关系](../../client-lib/client.html)
    *   [旧版本兼容](../../compatibility.html)
    *   [更新日志](../../release.html)
        *   [v2.x版本](../../release/v2.html)
        *   [v1.x版本](../../release/v1.html)
        *   [v0.x版本](../../release/v0.html)

</nav>

</div>

<div class="book-body">

<div class="body-inner">

<div class="page-wrapper" tabindex="-1" role="main">

<div class="page-inner">

<div id="book-search-results">

<div class="search-noresults">

<section class="normal markdown-section">

# 支付功能页

支付功能页用于帮助插件完成支付，相当于 `wx.requestPayment` 的功能。

需要注意的是：插件使用支付功能，需要进行额外的权限申请，申请位置位于[管理后台](https://mp.weixin.qq.com)的“小程序插件 -> 基本设置 -> 支付能力”设置项中。另外，无论是否通过申请，主体为个人小程序在使用插件时，都无法正常使用插件里的支付功能。

## 调用参数

支付功能页使用 `<functional-page-navigator>` 进行跳转时，对应的参数 name 应为固定值 `requestPayment`，其他参数如下：

**args参数说明：**

<table>

<thead>

<tr>

<th>参数名</th>

<th>类型</th>

<th>必填</th>

<th>说明</th>

</tr>

</thead>

<tbody>

<tr>

<td>fee</td>

<td>Number</td>

<td>是</td>

<td>需要显示在页面中的金额，单位为分</td>

</tr>

<tr>

<td>paymentArgs</td>

<td>Object</td>

<td>否</td>

<td>任意数据，传递给功能页中的响应函数</td>

</tr>

</tbody>

</table>

**回调结果：**

<table>

<thead>

<tr>

<th>回调类型</th>

<th>errMsg</th>

<th>说明</th>

</tr>

</thead>

<tbody>

<tr>

<td>success</td>

<td>requestPayment:ok</td>

<td>调用支付成功</td>

</tr>

<tr>

<td>fail</td>

<td>requestPayment:fail cancel</td>

<td>用户取消支付</td>

</tr>

<tr>

<td>fail</td>

<td>requestPayment:fail (detail message)</td>

<td>调用支付失败，其中 detail message 为后台返回的详细失败原因</td>

</tr>

</tbody>

</table>

**代码示例：**

    <!-- plugin/components/pay.wxml -->
    <!-- 上线时，version 应改为 "release"，并确保插件所有者小程序已经发布 -->
    <functional-page-navigator
      version="develop"
      name="requestPayment"
      args="{{ args }}"
      bind:success="paymentSuccess"
      bind:fail="paymentFailed"
    >
      <button class="payment-button">支付 0.01 元</button>
    </functional-page-navigator>

    // plugin/components/pay.js
    Component({
      data: {
        args: {
          fee: 1,             // 支付金额，单位为分
          customArgument: 'A' // 将传递到功能页函数的自定义参数
        }
      },
      methods: {
        // 支付成功的回调接口
        paymentSuccess: function (e) {
          console.log(e);
        },
        // 支付失败的回调接口
        paymentFailed: function (e) {
          console.log(e);
        }
      }
    })

用户点击该 `navigator` 后，将跳转到如下的支付功能页：

![支付功能页](https://developers.weixin.qq.com/miniprogram/dev/image/payment-functional-page.png?t=18110517)

## 配置功能页函数

支付功能页需要插件开发者在插件所有者小程序中提供一个函数来响应插件中的支付调用。即，在插件中跳转到支付功能页时，这个函数就会在合适的时机被调用，来帮助完成支付。如果不提供功能页函数，功能页调用将通过 `fail` 事件返回失败。

支付功能页函数应以导出函数的形式提供在插件所有者小程序的根目录下的 `functional-pages/request-payment.js` 文件中，名为 `beforeRequestPayment`。该函数应接收两个参数：

<table>

<thead>

<tr>

<th>参数名</th>

<th>类型</th>

<th>说明</th>

</tr>

</thead>

<tbody>

<tr>

<td>paymentArgs</td>

<td>Object</td>

<td>即通过 `<functional-page-navigator>` 的 `arg` 参数中的 `paymentArgs` 字段传递到功能页的自定义数据</td>

</tr>

<tr>

<td>callback</td>

<td>Function</td>

<td>回调函数，调用该函数后，小程序将发起支付（类似于 `wx.requestPayment`）</td>

</tr>

</tbody>

</table>

**callback函数的参数：**

<table>

<thead>

<tr>

<th>参数名</th>

<th>类型</th>

<th>说明</th>

</tr>

</thead>

<tbody>

<tr>

<td>error</td>

<td>Object</td>

<td>失败信息，若无失败，应返回 `null`</td>

</tr>

<tr>

<td>requestPaymentArgs</td>

<td>Object</td>

<td>支付参数，用于调用 `wx.requestPayment`，参数如下</td>

</tr>

</tbody>

</table>

**reqeustPaymentArgs 的参数：**

用于发起支付，和 [`wx.requestPayment`](../../../api/open-api/payment/wx.requestPayment.html) 的参数相同，但没有回调函数（`success`, `fail`, `complete`）：

<table>

<thead>

<tr>

<th>参数</th>

<th>类型</th>

<th>必填</th>

<th>说明</th>

</tr>

</thead>

<tbody>

<tr>

<td>timeStamp</td>

<td>String</td>

<td>是</td>

<td>时间戳从1970年1月1日00:00:00至今的秒数,即当前的时间</td>

</tr>

<tr>

<td>nonceStr</td>

<td>String</td>

<td>是</td>

<td>随机字符串，长度为32个字符以下。</td>

</tr>

<tr>

<td>package</td>

<td>String</td>

<td>是</td>

<td>统一下单接口返回的 prepay_id 参数值，提交格式如：prepay_id=***</td>

</tr>

<tr>

<td>signType</td>

<td>String</td>

<td>是</td>

<td>签名算法，暂支持 MD5</td>

</tr>

<tr>

<td>paySign</td>

<td>String</td>

<td>是</td>

<td>签名,具体签名方案参见[小程序支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&index=3);</td>

</tr>

</tbody>

</table>

了解更多信息，请查看[微信支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_3&index=1)

**功能页函数代码示例：**

    // functional-pages/request-payment.js
    exports.beforeRequestPayment = function (paymentArgs, callback) {
      // 注意：
      // 功能页函数（这个函数）不应 require 其他非 functional-pages 目录中的文件，
      // 其他非 functional-pages 目录中的文件也不应 require 这个目录中的文件，
      // 这样的 require 调用在未来将不被支持。
      //
      // 同在 functional-pages 中的文件可以 require
      var getOpenIdURL = require('./URL').getOpenIdURL;
      var paymentURL = require('./URL').paymentURL;

      // 自定义的参数，此处应为从插件传递过来的 'A'
      var customArgument = paymentArgs.customArgument;

      // 第一步：调用 wx.login 方法获取 code，然后在服务端调用微信接口使用 code 换取下单用户的 openId
      // 具体文档参考 https://mp.weixin.qq.com/debug/wxadoc/dev/api/api-login.html#wxloginobject
      wx.login({
        success: function (data) {
          wx.request({
            url: getOpenIdURL,
            data: { code: data.code },
            success: function (res) {
              // 拉取用户 openid 成功
              // 第二步：在服务端调用支付统一下单，返回支付参数。这里的开发和普通的 wx.requestPayment 相同
              // 文档可以参考 https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_4&index=3
              wx.request({
                url: paymentURL,
                data: { openid: res.data.openid },
                method: 'POST',
                success: function (res) {
                  console.log('unified order success, response is:', res);
                  var payargs = res.data.payargs;
                  // 第三步：调用回调函数 callback 进行支付
                  // 在 callback 中需要返回两个参数： err 和 requestPaymentArgs：
                  // err 应为 null （或者一些失败信息）；
                  // requestPaymentArgs 将被用于调用 wx.requestPayment，除了 success/fail/complete 不被支持外，
                  // 应与 wx.requestPayment 参数相同。
                  var error = null;
                  var requestPaymentArgs = {
                    timeStamp: payargs.timeStamp,
                    nonceStr: payargs.nonceStr,
                    package: payargs.package,
                    signType: payargs.signType,
                    paySign: payargs.paySign,
                  };
                  callback(error, requestPaymentArgs);
                }
              });
            },
            fail: function (res) {
              console.log('拉取用户openid失败，将无法正常使用开放接口等服务', res);
              // callback 第一个参数为错误信息，返回错误信息
              callback(res);
            }
          });
        },
        fail: function (err) {
          console.log('wx.login 接口调用失败，将无法正常使用开放接口等服务', err)
          // callback 第一个参数为错误信息，返回错误信息
          callback(err);
        }
      });
    }

**注意：功能页函数不应 `require` 其他非 `functional-pages` 目录中的文件，其他非 `functional-pages` 目录中的文件也不应 `require` 这个目录中的文件。这样的 `require` 调用在未来将不被支持。**

**这个目录和文件应当被放置在插件所有者小程序代码中（而非插件代码中），它是插件所有者小程序的一部分（而非插件的一部分）。** 如果需要新增或更改这段代码，需要发布插件所有者小程序，才能在正式版中生效；需要重新预览插件所有者小程序，才能在开发版中生效。

</section>

</div>

<div class="search-results">

<div class="has-results">

# <span class="search-results-count"></span>个结果 "<span class="search-query"></span>"

</div>

<div class="no-results">

# 没有找到相关内容 "<span class="search-query"></span>"

</div>

</div>

</div>

</div>

</div>

<div class="foot" id="footer">

*   [关于腾讯](https://www.tencent.com/)
*   [文档中心](https://developers.weixin.qq.com/miniprogram/introduction/index.html)
*   [辟谣中心](https://mp.weixin.qq.com/cgi-bin/opshowpage?action=dispelinfo)
*   [客服中心](https://kf.qq.com/product/wx_xcx.html)
*   [联系邮箱](mailto:weixinmp@qq.com)
*   Copyright © 2012-<span id="s_copyright_year"></span> Tencent. All Rights Reserved.

</div>

</div>

[](./user-info.html)[](./choose-address.html)</div>

</div>